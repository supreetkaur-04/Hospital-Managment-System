{% extends 'hospital/doctor_base.html' %}
{% block content %}
{% load static %}

<head>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    :root {
      --primary-medical: #2A5C82;
      --secondary-medical: #1A3A4B;
      --accent-emergency: #D32F2F;
      --accent-secondary: #4CAF50;
      --text-primary: #2D3748;
      --text-secondary: #718096;
    }

    .medical-card {
      border: 1px solid rgba(42, 92, 130, 0.1);
      border-radius: 12px;
      box-shadow: 0 4px 24px rgba(0, 0, 0, 0.08);
      overflow: hidden;
      margin: 2rem auto;
      max-width: 1200px;
    }

    .medical-card-header {
      background: linear-gradient(135deg, var(--primary-medical), var(--secondary-medical));
      color: white;
      padding: 1.5rem 2rem;
      border-bottom: none;
    }

    .medical-card-title {
      font-family: 'Poppins', sans-serif;
      font-weight: 600;
      margin: 0;
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .table-medical {
      background: white;
      margin: 0;
    }

    .table-medical thead {
      background: rgba(42, 92, 130, 0.05);
    }

    .table-medical th {
      font-weight: 600;
      color: var(--primary-medical);
      padding: 1.25rem;
      border-bottom: 2px solid rgba(42, 92, 130, 0.1);
    }

    .table-medical td {
      padding: 1.25rem;
      vertical-align: middle;
      border-color: rgba(42, 92, 130, 0.05);
    }

    .patient-avatar {
      width: 45px;
      height: 45px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid var(--primary-medical);
    }

    .delete-btn {
      padding: 0.5rem 1rem;
      border-radius: 8px;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .delete-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 2px 8px rgba(210, 47, 47, 0.2);
    }

    @media (max-width: 768px) {
      .medical-card {
        margin: 1rem;
      }
      
      .table-medical {
        font-size: 0.9rem;
      }
      
      .patient-avatar {
        width: 35px;
        height: 35px;
      }
    }
  </style>
</head>

<div class="container-fluid">
  <div class="medical-card">
    <div class="medical-card-header">
      <h3 class="medical-card-title">
        <i class="fas fa-calendar-times"></i>
        Manage Appointments
      </h3>
    </div>
    
    <div class="table-responsive">
      <table class="table table-medical">
        <thead>
          <tr>
            <th>Patient</th>
            <th>Profile</th>
            <th>Details</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for a,p in appointments %}
          <tr>
            <td class="fw-500">{{a.patientName}}</td>
            <td>
              <img src="{% static p.profile_pic.url %}" 
                   class="patient-avatar" 
                   alt="{{a.patientName}}">
            </td>
            <td class="text-secondary">
              <div class="text-truncate" style="max-width: 300px;">
                {{a.description}}
              </div>
            </td>
            <td>
              <a href="{% url 'delete-appointment' a.id %}" 
                 class="btn btn-danger delete-btn"
                 data-bs-toggle="modal" 
                 data-bs-target="#confirmDeleteModal">
                <i class="fas fa-trash-alt"></i>
                <span class="d-none d-md-inline">Cancel</span>
              </a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="confirmDeleteModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title text-danger">
          <i class="fas fa-exclamation-triangle me-2"></i>
          Confirm Cancellation
        </h5>
      </div>
      <div class="modal-body">
        Are you sure you want to cancel this appointment? This action cannot be undone.
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <a href="#" class="btn btn-danger" id="confirmDeleteButton">Confirm</a>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    var deleteButtons = document.querySelectorAll('.delete-btn');
    var confirmDeleteButton = document.getElementById('confirmDeleteButton');
    
    deleteButtons.forEach(function(button) {
      button.addEventListener('click', function(e) {
        e.preventDefault();
        var deleteUrl = this.getAttribute('href');
        confirmDeleteButton.setAttribute('href', deleteUrl);
      });
    });
  });
</script>

{% endblock content %}